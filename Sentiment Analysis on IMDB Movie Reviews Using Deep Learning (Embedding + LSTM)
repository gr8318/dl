import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers

# 1) Load IMDB dataset
num_words = 10000  # only keep top 10k words
maxlen = 200  # pad/truncate reviews to 200 words
(X_train, y_train), (X_test, y_test) = keras.datasets.imdb.load_data(
    num_words=num_words
)

# 2) Pad sequences to same length
X_train = keras.preprocessing.sequence.pad_sequences(X_train, maxlen=maxlen)
X_test = keras.preprocessing.sequence.pad_sequences(X_test, maxlen=maxlen)

# 3) Build model
model = keras.Sequential(
    [
        layers.Embedding(
            input_dim=num_words, output_dim=32, input_length=maxlen
        ),
        layers.LSTM(64),  # LSTM for sequence learning
        layers.Dense(1, activation='sigmoid'),  # Output layer (binary classification)
    ]
)

# 4) Compile model
model.compile(optimizer='adam', loss='binary_crossentropy', metrics=['accuracy'])

# 5) Train model
print("Starting model training...")
history = model.fit(
    X_train,
    y_train,
    epochs=3,
    batch_size=128,
    validation_split=0.2,
    verbose=1,
)
print("Model training finished.")

# 6) Evaluate on test data
print("Evaluating model on test data...")
loss, acc = model.evaluate(X_test, y_test, verbose=2)
print(f"\nTest Accuracy: {acc:.4f}")
